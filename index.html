<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>E Collision Jobs</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body { font-family: system-ui; margin:0; padding:15px; background:#f3f4f6;}
    h1 { margin-top:0; }
    input, textarea, select {
      width:100%; padding:8px; margin-bottom:8px;
      border-radius:6px; border:1px solid #ccc;
    }
    button {
      padding:8px 14px; border:none; border-radius:999px;
      cursor:pointer; margin-right:5px;
    }
    .primary { background:#111827; color:white; }
    .danger { background:#b91c1c; color:white; }
    table {
      width:100%; border-collapse:collapse; margin-top:15px;
      background:white;
    }
    th, td {
      padding:8px; border-bottom:1px solid #ddd; font-size:13px;
    }
  </style>
</head>
<body>

<h1>E Collision â€“ Jobs</h1>

<h3>Add Job</h3>

<input id="vin" placeholder="VIN">
<input id="customer" placeholder="Customer">
<input id="year" placeholder="Year">
<input id="make" placeholder="Make">
<input id="model" placeholder="Model">
<textarea id="notes" placeholder="Notes"></textarea>

<button class="primary" onclick="saveJob()">Save Job</button>

<h3>Job List</h3>

<table>
  <thead>
    <tr>
      <th>VIN</th>
      <th>Customer</th>
      <th>Vehicle</th>
      <th>Action</th>
    </tr>
  </thead>
  <tbody id="jobTable"></tbody>
</table>

<script>

const SUPABASE_URL = "https://xmbochwqaeakijotbcof.supabase.co";
const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InhtYm9jaHdxYWVha2lqb3RiY29mIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjkwMjI5MTIsImV4cCI6MjA4NDU5ODkxMn0.YoxRzHEDrM9pDNEOL7mLaJewzcGB3jbZ-rc4IkR1hmQ";

async function fetchJSON(url, options = {}) {
  options.headers = {
    apikey: SUPABASE_KEY,
    Authorization: "Bearer " + SUPABASE_KEY,
    "Content-Type": "application/json"
  };
  const res = await fetch(url, options);
  if (!res.ok) {
    const txt = await res.text();
    throw new Error(txt);
  }
  return await res.json();
}

async function loadJobs() {
  const url = SUPABASE_URL + "/rest/v1/jobs?select=*";
  const data = await fetchJSON(url);
  renderJobs(data);
}

async function saveJob() {
  const job = {
    vin: vin.value.trim(),
    customer: customer.value.trim(),
    year: year.value.trim(),
    make: make.value.trim(),
    model: model.value.trim(),
    notes: notes.value.trim()
  };

  if (!job.vin) {
    alert("VIN required");
    return;
  }

  await fetchJSON(SUPABASE_URL + "/rest/v1/jobs", {
    method: "POST",
    body: JSON.stringify(job),
    headers: { Prefer: "return=representation" }
  });

  vin.value = "";
  customer.value = "";
  year.value = "";
  make.value = "";
  model.value = "";
  notes.value = "";

  loadJobs();
}

async function deleteJob(id) {
  if (!confirm("Delete this job?")) return;

  const url = SUPABASE_URL + "/rest/v1/jobs?id=eq." + id;

  const res = await fetch(url, {
    method: "DELETE",
    headers: {
      apikey: SUPABASE_KEY,
      Authorization: "Bearer " + SUPABASE_KEY
    }
  });

  if (!res.ok) {
    const txt = await res.text();
    alert("Delete failed: " + txt);
    return;
  }

  loadJobs();
}

function renderJobs(jobs) {
  const table = document.getElementById("jobTable");
  table.innerHTML = "";

  jobs.forEach(job => {
    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td>${job.vin || ""}</td>
      <td>${job.customer || ""}</td>
      <td>${job.year || ""} ${job.make || ""} ${job.model || ""}</td>
      <td>
        <button class="danger" onclick="deleteJob('${job.id}')">Delete</button>
      </td>
    `;
    table.appendChild(tr);
  });
}

loadJobs();

</script>

</body>
</html>
